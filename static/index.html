<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1/dist/leaflet.min.js"></script>
    <title>Bus Photos</title>
    <style>
        * {
            touch-action: manipulation;
            margin: 0px;
            padding: 0px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            font-weight: normal;
            border: none;
            font-family: sans-serif;
            -webkit-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
        }

        #content {
            text-align: center;
            font-family: Arial, sans-serif;
            pointer-events: none;
        }

        #title {
            font-size: min(6vw, 6vh);
            margin: min(3vw, 3vh);
            font-weight: bold;
        }

        #heading {
            width: auto;
            height: min(30vh, 30vw);
            border-radius: 5%;
        }

        #content,
        #map,
        #mask {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        #map {
            z-index: -2;
        }

        #gift-form {
            pointer-events: auto;
            max-width: fit-content;
            margin: auto;
        }

        p,
        label,
        input {
            font-size: min(2vw, 2vh);
        }

        p,
        label {
            margin: min(1vw, 1vh) 0px;
        }

        #mask {
            background-color: white;
            opacity: 0.5;
            z-index: -1;
            pointer-events: none;
        }

        input {
            padding: min(0.5vw, 0.5vh) min(1vw, 1vh);
            background-color: gold;
            border-radius: min(0.5vw, 0.5vh);
            border: min(0.3vw, 0.3vh) solid black;
            width: min(30vw, 30vh);
        }
    </style>
</head>

<body>
    <div id="content">
        <h1 id="title">Bus Photos</h1>
        <img id="heading" src="WT_295.jpg">
        <p>Tracking bus photos since 2025</p>
        <div id="form-container">
            <form id="gift-form">
                <label for="name">First name: </label>
                <input id="name" type="text" name="name" required>
                <br>
                <label for="gift">Photo link: </label>
                <input id="gift" type="text" name="gift" required>
                <br>
                <input type="submit" value="Submit!">
            </form>
        </div>
        <div id="gifts"></div>
    </div>
    <div id="mask"></div>
    <div id="map"></div>
</body>
<script>

    var map = L.map("map").fitBounds([[49.71, -97.35], [50.00, -96.95]]);
    L.tileLayer("https://trn-maps.winnipeg.ca/day/{z}/{x}/{y}.png", {
        maxZoom: 19,
    }).addTo(map);

    const form = document.getElementById("gift-form");
    const giftsContainer = document.getElementById("gifts");

    async function loadGifts() {
        const response = await fetch('/gifts');
        const gifts = await response.json();

        giftsContainer.innerHTML = '';
        gifts.forEach(gift => {
            const item = document.createElement("p");
            item.textContent = `Gift for ${gift.name}: ${gift.gift}`;
            giftsContainer.appendChild(item);
        });
    }

    form.addEventListener("submit", async (event) => {
        event.preventDefault();

        const name = form.elements.name.value;
        const gift = form.elements.gift.value;

        await fetch('/gifts', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name, gift })
        });

        form.reset();
        await loadGifts();
    });

    loadGifts();
</script>

</html>